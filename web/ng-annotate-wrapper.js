"use strict";function transform(r,e,t){var n=ngAnnotate(e.toString(),t);if(n.errors){var a="";throw r.path&&(a=r.relative+": "),new gutil.PluginError(PLUGIN_NAME,a+n.errors.join("\n"))}if(t.map&&r.sourceMap){var u=JSON.parse(n.map),o=r.relative.replace(/\\/g,"/");r.sourceMap.file!==o&&(t.gulpWarnings!==!1&&gutil.log(PLUGIN_NAME,"workaround for GH-26: change sourcemap `file` option from `"+r.sourceMap.file+"` to `"+o+"`; if it breaks your sourcemap setup, please comment at https://github.com/Kagami/gulp-ng-annotate/issues/26 (you can mute this warning with `gulpWarnings: false` option)"),r.sourceMap.file=o),u.file=r.relative,applySourceMap(r,u)}return new Buffer(n.src)}var gutil=require("gulp-util"),through=require("through2"),ngAnnotate=require("ng-annotate"),applySourceMap=require("vinyl-sourcemaps-apply"),merge=require("merge"),BufferStreams=require("bufferstreams"),PLUGIN_NAME="gulp-ng-annotate";module.exports=function(r){return r=r||{},r.remove||(r=merge({add:!0},r)),through.obj(function(e,t,n){if(e.isNull())return this.push(e),n();var a=merge({map:!!e.sourceMap},r);if(a.map&&("boolean"==typeof a.map&&(a.map={}),e.path&&(a.map.inFile=e.relative)),e.isBuffer())try{e.contents=transform(e,e.contents,a)}catch(u){return this.emit("error",u),n()}else e.contents=e.contents.pipe(new BufferStreams(function(r,t,n){if(r)return n(new gutil.PluginError(PLUGIN_NAME,r));try{var u=transform(e,t,a)}catch(o){return n(o)}n(null,u)}));this.push(e),n()})};